@model IEnumerable<project.Models.Requesttbl>
@using project.Models;
@{
    projectdbEntities dbb = new projectdbEntities();
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout1.cshtml";
}

<br />
<br />


<div class="col-lg-12">

    <table class="table">
        <tr>
            <th>
                File
            </th>
            <th>
                @Html.DisplayNameFor(model => model.requesttyepe)
            </th>
           

            
        </tr>

        @foreach (var item in Model)
        {
            <tr>
                <td>
                    <a href="~/Home/detail/@Html.DisplayFor(modelItem => item.fileid)" target="_blank"> @dbb.filestbls.Where(x => x.fileid.ToString() == item.fileid).FirstOrDefault().filename   </a>
                </td>
                <td>
                    <a href="#" onclick="showdetail('@item.causeofrequest','@item.id')"> @Html.DisplayFor(modelItem => item.requesttyepe)</a> 
                </td>
              

                
            </tr>
        }

    </table>
</div>


<script>

    var type = "";
    function acceptreq(id) {
        type = "accpet";
    }

    function denyreq(id) {
        type = "deny";
    }

    function showdetail(cause,id) {
        Swal.fire({
            title: 'Are you sure you want to accept this request?',
            text: cause,
            customClass: 'swal-wide',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            cancelButtonText:'Reject',
            confirmButtonText: 'Accept'
        }).then((result) => {
            if (result.isConfirmed) {


                type = "accept";




            }

            else {
                type = "reject";
            }





            Swal.fire({
                title: "Respond",
                text: "you can write your cause of response",
                input: 'text',
                customClass: 'swal-wide',
                showCancelButton: true
            }).then((result) => {
                if (result.value) {

                      var formData = new FormData();
                    var token = getCookie("token");
                   
                    formData.append("id", id);
                    formData.append("type", type);
                    formData.append("cause", result.value);
               
                    $.ajax({
                        url: '/api/FileAPI/RespondtoRequest/',
                        type: 'PUT',
                        data: formData,
                        cache: false,
                        contentType: false,
                        headers: {
                            "authorization": "bearer " + token,

                        },
                        processData: false,

                        success: function (fileName) {

                            Swal.fire(fileName, '', 'info');
                            setTimeout(() => { window.location = '/Admin/Index/' }, 2000);
                        },
                        xhr: function () {
                            var fileXhr = $.ajaxSettings.xhr();
                            if (fileXhr.upload) {
                                $("progress").show();
                                fileXhr.upload.addEventListener("progress", function (e) {
                                    if (e.lengthComputable) {
                                        $("#fileProgress").attr({
                                            value: e.loaded,
                                            max: e.total
                                        });
                                    }
                                }, false);
                            }
                            return fileXhr;
                        }
                    });




                }
            });







        })
    }



</script>